产品需求文档：AI驱动的CAD规范符合性检查器

版本： 1.0
日期： 2025年10月13日
作者：

1. 引言与愿景

本文档旨在阐述一款AI驱动的Web应用的需求。该应用旨在自动化检查CAD图纸是否符合既定的工程标准（初期专注于GB/T 14665-2012）。系统将分析用户上传的CAD文件，识别与标准的偏差，并生成一份包含可操作反馈的、用户友好的综合报告。
我们的愿景是为工程师和设计师创造一个智能助手，它能显著减少人工审查时间、最大限度地减少人为错误、提高设计质量，并降低因图纸不合规而导致的昂贵制造成本风险。

2. 目标用户

机械工程师与CAD设计师： 创建和修改CAD图纸的主要用户。他们需要一个快速、可靠的工具，在提交前自行检查工作成果。
质量保证（QA）工程师与审核员： 负责正式批准图纸的用户。他们需要一个全面的工具来标准化并加速审查流程。
团队负责人与工程经理： 需要确保整个团队的设计一致性和质量的用户。

3. 高层架构与技术栈

本系统将作为前后端分离的Web应用进行开发，优先采用成熟、社区支持良好的开源技术。
后端语言： Python 3.9+
后端框架： FastAPI 或 Flask (用于构建健壮的API)
CAD文件解析： ezdxf - 一个功能强大且稳定的库，用于读写和操作DXF文件。对于DWG格式的支持，可搭配ODA文件转换器等外部工具，先将DWG转换为DXF再进行解析。
几何分析：
Shapely：用于所有二维几何关系计算（如相交、距离等）。
CadQuery：主要用于程序化地生成合成CAD数据（包括合规与不合规的样本），以在第二阶段训练计算机视觉模型。
AI / 机器学习：
计算机视觉 (CV): PyTorch 或 TensorFlow，用于训练和部署模型以检测视觉/空间问题。
大型语言模型 (LLM): 通过API与功能强大的LLM（如Gemini）集成，用于语义分析和报告生成。
前端框架： Next.js 或 React (用于构建现代化的响应式用户界面)。
部署策略：
前端： 设计为静态/服务端渲染站点，非常适合部署在 Vercel。
后端： 包含其依赖项和文件处理需求的Python后端，将使用 Docker 进行容器化。这允许其灵活部署到任何容器托管服务（例如Google Cloud Run, AWS Fargate, 或私有服务器）。

4. 分阶段功能实施计划

项目将分三个不同阶段进行开发，以实现价值的增量交付并有效管理复杂性。

第一阶段：MVP - 基础规则引擎

目标： 启动一个功能性的核心产品，自动化处理最常见、确定性的检查项，快速提供初始价值。
功能ID
功能名称
用户故事
验收标准
P1-F01
文件上传与解析
作为一名设计师，我希望能将DXF文件上传到Web应用，以便系统进行分析。
1. UI提供清晰的拖放或文件选择界面。 2. 系统接受 .dxf 文件。 3. 后端使用 ezdxf 将文件无误地解析为结构化数据格式（如场景图）。 4. 用户收到上传成功并开始分析的反馈。
P1-F02
原始属性检查器
作为一名QA工程师，我希望系统能根据GB/T 14665-2012标准，自动检查图纸的基本属性。
1. 图层： 验证图元是否位于标准表6定义的正确图层上。 2. 线宽与颜色： 检查线宽和屏幕显示颜色是否符合标准表1和表2的规范。 3. 字体： 根据图纸幅面，验证汉字和字母数字的字高是否符合标准表3的要求。 4. 尺寸终端： 检查一致性，确保超过95%的尺寸终端是同一类型（如实心箭头），符合标准6.3节的建议。
P1-F03
基础合规报告
作为一名用户，我希望能看到一份清晰、简洁的报告，列出在我的图纸中发现的所有违规项。
1. 分析完成后显示一个新的报告页面。 2. 报告逐条列出发现的每个违规项。 3. 每个列表项清晰说明违反的规则（例如，“尺寸文字的图层不正确”）以及可用的位置或实体句柄。 4. 报告可以导出或复制到剪贴板。


第二阶段：高级空间与视觉分析

目标： 增强系统的检测能力，以识别需要算法和视觉分析的、更复杂的几何与空间关系错误。
功能ID
功能名称
用户故事
验收标准
P2-F01
几何关系引擎
作为一名设计师，我希望系统能发现像线条交叉和标注未对齐这样的几何错误。
1. 系统使用 Shapely 检测尺寸线是否与尺寸文字的边界框相交。 2. 系统计算尺寸线端点与尺寸界线之间的距离，以确保它们正确接触。 3. 系统识别垂直或水平对齐的尺寸组，并验证其文字（及小数点）是否对齐。
P2-F02
计算机视觉(CV)子系统
作为一名审核员，我希望系统能标记出那些视觉上“混乱”或难以阅读的区域，这些区域可能技术上正确但实际上存在问题。
1. 后端识别“潜在问题区域”（例如，小于45°的锐角标注，密集的注释群）。 2. 这些感兴趣区域（ROI）被渲染成小块图像。 3. 一个预训练的CV分类模型分析每个ROI图像，并给出一个“清晰度得分”。 4. 得分低于预设阈值的ROI被标记为违规。
P2-F03
交互式可视化报告
作为一名用户，我希望能在图纸上精确地看到错误的位置，而不仅仅是阅读一个列表。
1. 报告页面采用分栏视图：一侧是错误列表，另一侧是CAD图纸的SVG/PNG渲染图。 2. 点击列表中的错误项，会自动在图纸预览中缩放并高亮显示相应区域。 3. 由CV模型检测到的视觉错误，会通过一个覆盖层高亮显示问题区域。


第三阶段：语义与上下文智能

目标： 通过引入LLM驱动的语义理解和解释生成能力，将系统从一个检查工具提升为一个智能助手。
功能ID
功能名称
用户故事
验收标准
P3-F01
LLM驱动的文本分析
作为一名高级工程师，我希望系统能阅读技术要求，并标记出模糊的语言或非标准的术语。
1. 系统从MTEXT实体中提取所有文本内容，特别是标题栏和技术要求部分。 2. 该文本通过API调用发送给一个LLM（如Gemini）。 3. LLM使用精心设计的提示词来检查：是否使用国家规定的简化字（根据标准5.4节）、表述的清晰度、完整性以及是否存在潜在矛盾。 4. LLM的发现被添加到合规报告中。
P3-F02
生成式错误解释
作为一名初级设计师，我不仅想知道哪里错了，更想理解为什么这是个错误以及如何修正它。
1. 对于在第一和第二阶段检测到的每一个违规项，系统都会调用LLM。 2. 提示词包含被违反的具体规则和该实体的上下文信息。 3. LLM生成一段清晰、简洁、易于理解的解释，说明该错误的重要性（例如，“该尺寸线穿过了文字，可能导致制造过程中的误读……”）并提出最佳实践的解决方案。
P3-F03
人在回路(Human-in-the-Loop)反馈
作为一名用户，我希望能将某个发现标记为“误报”，以帮助系统随时间推移而改进。
1. 报告中每个非确定性的发现（来自CV和LLM模块）旁边都有一个“正确”/“不正确”的反馈按钮。 2. 用户的反馈被记录在数据库中，将ROI图像或文本片段与用户的标签关联起来。 3. 这些收集到的数据将定期用于重新训练和微调AI模型，形成一个持续改进的良性循环。


5. 非功能性需求

性能： 对于一个平均大小的DXF文件（<10MB），第一阶段的解析和分析应在30秒内完成。第二和第三阶段的分析应在2分钟内完成。
可伸缩性： 容器化的后端应能水平扩展，以处理多个并发的分析请求。
安全性： 所有上传的文件必须在安全、隔离的环境中处理，并在分析和报告生成后删除。用户数据和报告应受到保护。
可用性： 用户界面必须简洁、直观，对于熟悉CAD软件的用户来说，几乎不需要培训。

6. 未来范围与潜力

在成功实施所有三个阶段后，该核心平台可以扩展以包括：
支持更多标准： 整合其他国家（ANSI, ISO）或企业特定的制图标准。
可制造性分析： 将分析扩展到检测设计中难以或成本高昂的制造特征。
实时CAD集成： 利用类似CAD-MCP等项目的概念，构建一个插件（例如，用于AutoCAD, SolidWorks），直接在用户的CAD环境中提供实时反馈。
自动化成本估算： 分析几何形状，为制造成本提供粗略估算。
